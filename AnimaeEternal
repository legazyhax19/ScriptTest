-- à¹‚à¸«à¸¥à¸” Fluent GUI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({
    Title = "HappyHUB",
    SubTitle = "By Legazyhax19",
    TabWidth = 160,
    Size = UDim2.fromOffset(520, 400),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "swords" })
}

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸„à¸±à¸
local monsterMap = {} -- [à¸Šà¸·à¹ˆà¸­ Title] = { Id = id, Health = health, Reference = mob }
local selectedMonsterId = nil
local selectedMobData = nil
local autofarm = false
local lastTarget = nil

-- Dropdown UI
local monsterDropdown = Tabs.Main:AddDropdown("SelectMonster", {
    Title = "à¹€à¸¥à¸·à¸­à¸à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ",
    Values = {},
    Multi = false,
    Default = nil
})

monsterDropdown:OnChanged(function(title)
    selectedMobData = monsterMap[title]
    selectedMonsterId = selectedMobData and selectedMobData.Id
    Fluent:Notify({
        Title = "à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§",
        Content = "ID: " .. tostring(selectedMonsterId),
        Duration = 3
    })
end)

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹‚à¸«à¸¥à¸”à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ
local function loadMonsters()
    monsterMap = {}
    selectedMonsterId = nil
    selectedMobData = nil
    monsterDropdown:SetValue(nil) -- à¸£à¸µà¹€à¸‹à¹‡à¸• dropdown
    
    local titles = {}
    for _, mob in pairs(workspace.Debris.Monsters:GetChildren()) do
        local id = mob:GetAttribute("Monster_Id")
        local title = mob:GetAttribute("Title")
        local health = tonumber(mob:GetAttribute("Health"))

        if id and title and not monsterMap[title] then
            monsterMap[title] = {
                Id = id,
                Health = health or 0,
                Reference = mob
            }
            table.insert(titles, title)
        end
    end
    
    monsterDropdown:SetValues(titles)
    
    Fluent:Notify({
        Title = "à¹‚à¸«à¸¥à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ",
        Content = "à¸žà¸š " .. #titles .. " à¸•à¸±à¸§\n(à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¹€à¸¥à¸·à¸­à¸à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ)",
        Duration = 3
    })
end

-- à¹‚à¸«à¸¥à¸”à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œà¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡ dropdown
loadMonsters()

-- à¸›à¸¸à¹ˆà¸¡ Refresh à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ
Tabs.Main:AddButton({
    Title = "ðŸ”„ à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸¡à¸­à¸™à¸ªà¹€à¸•à¸­à¸£à¹Œ",
    Callback = loadMonsters
})

-- Toggle à¹€à¸›à¸´à¸”/à¸›à¸´à¸” AutoFarm
Tabs.Main:AddToggle("AutoFarmToggle", {
    Title = "ðŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¸Ÿà¸²à¸£à¹Œà¸¡",
    Default = false,
    Callback = function(value)
        autofarm = value
    end
})

local RunService = game:GetService("RunService")
local currentTarget = nil
local hasWarped = false

local function setupTargetDeathListener(humanoid)
    if humanoid then
        if humanoid:FindFirstChild("__AutofarmDeath") then
            humanoid:FindFirstChild("__AutofarmDeath"):Destroy()
        end

        local tag = Instance.new("ObjectValue")
        tag.Name = "__AutofarmDeath"
        tag.Value = humanoid
        tag.Parent = humanoid

        humanoid.Died:Connect(function()
            currentTarget = nil
            hasWarped = false
        end)
    end
end

RunService.Heartbeat:Connect(function()
    if autofarm and selectedMonsterId then
        if not currentTarget or not currentTarget.Parent then
            currentTarget = nil
            hasWarped = false
        end

        if not currentTarget then
            for _, mob in pairs(workspace.Debris.Monsters:GetChildren()) do
                if mob:GetAttribute("Monster_Id") == selectedMonsterId then
                    local humanoid = mob:FindFirstChildOfClass("Humanoid")
                    if humanoid and humanoid.Health > 0 then
                        currentTarget = mob
                        setupTargetDeathListener(humanoid)
                        break
                    end
                end
            end
        end

        if currentTarget and not hasWarped then
            local mobHRP = currentTarget:FindFirstChild("HumanoidRootPart")
            if mobHRP and character and character.PrimaryPart then
                local safeOffset = Vector3.new(0, 3, -2)
                character:SetPrimaryPartCFrame(mobHRP.CFrame + safeOffset)
                hasWarped = true
            end
        end
    else
        currentTarget = nil
        hasWarped = false
    end
end)
